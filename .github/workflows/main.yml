name: Build FFmpeg Mac OS build
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
jobs:
  build:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v3
    - name: Uname...
      run: uname -a
    - name: Git clone vvenc, vvdec and FFmpeg
      run: git clone --depth=1 https://github.com/fraunhoferhhi/vvenc && git clone --depth=1 https://github.com/fraunhoferhhi/vvdec && git clone --depth=1 https://github.com/MartinEesmaa/FFmpeg
    - name: Build vvenc
      run: cd vvenc && mkdir build && cd build && cmake .. -G "Xcode" -DCMAKE_INSTALL_PREFIX=/usr/local && cmake --build . --config Release && cmake --build . --config Release --target install && cd ../../
    - name: Build vvdec
      run: cd vvdec && mkdir build && cd build && cmake .. -G "Xcode" -DCMAKE_INSTALL_PREFIX=/usr/local && cmake --build . --config Release && cmake --build . --config Release --target install && cd ../../
    - name: Install Package
      uses: ConorMacBride/install-package@v1.1.0
      with:
        brew: libxml2 opus sdl2 ffmpeg fdk-aac nasm dav1d
    - name: Run to compile ffmpeg
      run: cd FFmpeg && chmod +x configure && ./configure --enable-static --enable-libvvenc --enable-libvvdec --enable-libxml2 --enable-libdav1d --enable-libopus --enable-libfdk-aac --enable-pic --enable-sdl2 --pkg-config-flags=--static --extra-version=VVCEasy && make -j
    - name: Upload a Build Artifact of vvenc
      uses: actions/upload-artifact@v3.0.0
      with:
        name: ffmpeg
        path: ./FFmpeg
